datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model User {
  id           String   @id @default(cuid())
  email        String   @unique
  googleSub    String?  @unique
  accessToken  String?
  refreshToken String?
  tokenExpiry  DateTime?
  createdAt    DateTime @default(now())
  tasks        Task[]
  telegramUserId String? @unique
  telegramChatId String?
}

model Task {
  id          String   @id @default(cuid())
  userId      String
  title       String
  description String?
  source      String   @default("manual") // manual | gmail | calendar
  status      String   @default("PENDING") // PENDING|DOING|BLOCKED|DONE
  priority    Int      @default(2) // 1 high, 2 medium, 3 low
  dueAt       DateTime?
  assignee    String?  // Producción/Instalación/Compras/Diseño/Admin
  externalId  String?  // gmail messageId / calendar eventId
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  // vínculo con evento de Google
  googleEventId String?
  googleEventLink String?
  eventTimeZone String?
  eventStartLocal String?
  eventEndLocal String?

  user User @relation(fields: [userId], references: [id])

  @@index([userId, status])
  @@index([userId, dueAt])
  @@unique([userId, source, externalId])
}
